jstex.packages.midgard = {
    resources:{
	imgModus:"<svg id='box.svg' width='1em' height='0.8em' preserveAspectRatio='xMinYMin meet' viewBox='0 0 102.5 105'><g id='g10' transform='matrix(1.25,0,0,-1.25,0,105)'><path id='path32' style='fill:#000000;fill-opacity:1;fill-rule:nonzero;stroke:none' d='M 53.977,2.48086 C 52.2031,3.28594 48.6449,5.66484 46.066,7.76289 35.527,16.3449 33.5469,16.9539 29.852,12.743 l -2.3168,-2.6371 -4.1172,2.4382 c -5.3871,3.1868 -5.3321,3.109 -3.9059,5.8668 4.25,8.2153 13.5859,8.8672 23.8117,1.668 2.7813,-1.9609 2.8563,-1.9367 3.5,1.102 0.8481,4.0113 3.3133,6.2031 6.9774,6.2031 7.1168,0 10.4718,-8.4031 5.3898,-13.4879 -2.589,-2.5902 -2.5,-2.8441 1.2969,-3.657 6.5551,-1.40629 13.1141,4.9418 13.1141,12.6918 0,9.4222 -6.8129,14.9332 -19.9571,16.1562 -5.1758,0.4801 -5.391,0.4258 -7.8211,-2.0043 -3.2218,-3.2226 -5.9957,-3.2539 -9.1476,-0.1019 -1.9102,1.9113 -3.0903,2.4031 -5.7813,2.4031 -3.6961,0 -9.7,-3.227 -11.9301,-6.4059 l -1.2378,-1.7742 -3.129,2.516 C 11.3441,36.3371 4.34414,39.384 1.58984,39.384 0.305078,39.384 0,39.9191 0,42.1809 c 0,2.4531 0.25,2.8 1.99219,2.8 2.8789,0 9.65271,2.739 12.89491,5.2152 l 2.7969,2.1289 1.8469,-1.9922 c 2.6171,-2.8238 6.3242,-4.5617 10.891,-5.1019 3.6519,-0.4329 4.1011,-0.2887 6.2769,2.0429 3.0903,3.309 5.9141,3.3051 9.0082,-0.0027 2.2969,-2.4609 2.4649,-2.5039 7.7192,-2.032 6.7457,0.6097 10.441,1.6679 13.7929,3.9531 4.7379,3.2226 5.9797,5.6758 5.9797,11.7887 0,5.8871 -1.1207,8.2781 -5.3867,11.4613 -2.343,1.75 -7.9211,2.1098 -9.7101,0.625 -0.9461,-0.7852 -0.75,-1.3121 1.1871,-3.25 1.5308,-1.5313 2.3129,-3.1293 2.3129,-4.7344 0,-5.3047 -2.918,-8.1019 -8.4379,-8.1019 -3.4102,0 -5.6871,2.1179 -6.4063,5.95 L 46.227,65.7672 43.984,64.1691 C 40.0621,61.3762 33.293,58.5988 30.398,58.591 c -4.132,-0.0082 -8.121,2.3399 -10.171,5.9918 -0.993,1.7582 -1.8051,3.4344 -1.8129,3.7231 -0.0082,0.289 1.9808,1.648 4.4179,3.023 l 4.4301,2.5 2.7258,-2.891 c 3.657,-3.875 4.9961,-3.441 15.5633,5.0672 11.5,9.2578 20.8828,9.8828 29.1168,1.9371 5.148,-4.9684 6.4961,-8.3363 6.516,-16.2891 0.0148,-6.4293 -0.157,-7.175 -2.4031,-10.375 -1.3321,-1.8941 -4.0309,-4.6679 -6,-6.1601 -1.9688,-1.4961 -3.6481,-2.945 -3.734,-3.2258 -0.0821,-0.282 1.5269,-1.5902 3.582,-2.9113 2.1602,-1.3899 4.734,-4.0348 6.1172,-6.2848 C 84.902,22.6809 80.6211,7.72383 70.1449,2.65312 65.734,0.517188 58.4691,0.442188 53.977,2.48086 z M 76.3281,40.4809 c -0.8902,2.3171 0.016,4.1019 2.0821,4.1019 1.6757,0 1.9878,-0.3789 1.9878,-2.4019 0,-1.8789 -0.3859,-2.4528 -1.8,-2.6571 -1.0589,-0.1476 -1.996,0.2473 -2.2699,0.9571 z'/></g></svg>",
	imgObjectum:"<svg id='arrow.svg' width='1.8em' height='1em' preserveAspectRatio='xMinYMax meet' viewBox='0 0 518.125 243.125'><g id='g10' transform='matrix(1.25,0,0,-1.25,0,243.125)'><path id='path14' style='fill:#000000;fill-opacity:1;fill-rule:nonzero;stroke:none' d='m 287.793,144.109 c 0,0 -5.625,-0.937 -15.938,-1.875 1.875,18.75 -0.468,36.094 -7.496,52.032 -28.593,-49.688 -60.468,-74.528 -95.621,-74.528 0,0 -5.156,0.938 -15,2.813 27.657,11.246 45.934,33.746 55.309,67.965 -13.59,-8.907 -29.996,-13.125 -49.684,-13.125 -14.996,0 -30.933,4.687 -46.871,15 -6.094,-22.5 -12.656,-39.375 -19.687,-50.625 -10.313,-16.871 -23.903,-27.653 -41.246,-33.278 -4.219,11.25 -12.188,16.875 -24.371,16.875 -7.5,0 -13.594,-2.812 -19.219,-8.437 C 2.344,111.301 0,104.738 0,97.707 c 0,-7.5 2.344,-14.059 7.969,-19.684 5.156,-5.625 11.719,-8.437 19.219,-8.437 11.714,0 19.683,5.156 24.371,15.937 17.343,-5.156 31.402,-15.937 41.714,-32.812 6.563,-11.25 13.125,-28.125 19.219,-50.621 15.938,10.312 31.875,15.465 46.871,15.465 19.688,0 36.563,-4.684 49.684,-13.59 -9.375,34.215 -27.652,57.183 -55.309,68.433 9.844,1.875 15,2.813 15,2.813 35.153,0 67.028,-25.313 95.621,-74.996 6.09,13.594 9.371,24.84 9.371,33.277 0,0.938 -0.937,7.5 -1.875,18.75 5.157,-0.937 10.782,-0.937 16.407,-0.937 41.246,0 82.965,15.468 126.086,46.402 -44.059,30.938 -86.246,46.402 -126.555,46.402 z m 52.965,-70.773 c -19.219,-6.563 -37.028,-9.375 -52.965,-9.375 -1.875,0 -12.188,0.937 -30.934,2.812 2.813,-11.25 3.75,-18.75 3.75,-21.562 l -0.937,-16.406 c -7.969,15.937 -20.156,30 -36.563,41.718 -17.812,11.719 -35.152,17.809 -52.496,17.809 -17.812,0 -31.871,-6.09 -41.246,-17.809 24.371,-6.562 44.059,-22.031 59.059,-45.468 l -0.938,-0.938 c -7.968,4.688 -18.75,7.5 -31.875,7.5 -10.777,0 -22.496,-3.75 -35.621,-11.25 -13.594,45.469 -35.625,70.778 -66.558,75.465 l 0,2.813 c 30.933,5.156 52.964,30.468 66.558,75.933 13.125,-7.5 24.844,-11.25 35.621,-11.25 13.125,0 23.907,2.344 31.875,7.5 l 0.938,-0.937 c -15,-23.907 -34.688,-38.903 -59.059,-45.465 9.375,-12.188 23.434,-17.813 41.246,-17.813 17.344,0 34.684,5.625 52.496,17.813 16.407,11.246 28.594,25.308 36.563,41.715 l 0.937,-16.407 c 0,-3.281 -0.937,-10.312 -3.75,-21.558 8.438,0.937 16.403,1.406 24.84,1.406 40.309,0 76.403,-10.781 108.274,-31.875 C 375.91,87.863 359.508,79.898 340.758,73.336 z m -313.57,6.562 c -11.25,0 -16.876,5.625 -16.876,17.809 0,11.25 5.626,17.344 16.876,17.344 11.246,0 16.871,-6.094 16.871,-17.344 0,-12.184 -5.625,-17.809 -16.871,-17.809'/></g></svg>",
    },
    useEnergy:false,
    copperPerSilver:10,
    silverPerGold:10,
    load:function(args){
	jstex.newCommand("imgObjectum",function(tokens,parent){
	    var span = jstex.createDummy("=>");
	    span.innerHTML = jstex.packages.midgard.resources.imgObjectum;
	    parent.appendChild(span);
	    return true;
	});
	jstex.newCommand("imgModus",function(tokens,parent){
	    var span = jstex.createDummy("#");
	    span.innerHTML = jstex.packages.midgard.resources.imgModus;
	    parent.appendChild(span);
	    return true;
	});
	jstex.newCommand("EnergieSystem",function(tokens,parent){
	    jstex.packages.midgard.useEnergy=true;
	    return true;
	});
	jstex.newCommand("geld",function(tokens,parent){
	    jstex.buffer.innerHTML="";
	    jstex.expandNext(tokens,jstex.buffer);
	    var kp = parseInt(jstex.buffer.innerHTML);
	    var sp = kp/jstex.packages.midgard.copperPerSilver;
	    kp -= sp*jstex.packages.midgard.copperPerSilver;
	    var gp = sp/jstex.packages.midgard.silverPerGold;
	    sp -= gp*jstex.packages.midgard.silverPerGold;
	    if(gp > 0){
		parent.appendText(gp+" GS");
		if(sp>0 || kp>0) parent.appendText(" ");
	    }
	    if(sp > 0){
		parent.appendText(sp+" SS");
		if(kp>0) parent.appendText(" ");
	    }
	    if(kp > 0){
		parent.appendText(kp+" KS");
	    }
	    return true;
	});
	jstex.newCommand("EnergieOrDFR",function(tokens,parent){
	    if(jstex.packages.midgard.useEnergy){
		first = jstex.expandNext(tokens,jstex.buffer);
		second = jstex.expandNext(tokens,parent);
		return first;
	    } else {
		first = jstex.expandNext(tokens,parent);
		second = jstex.expandNext(tokens,jstex.buffer);
		return second;
	    }
	    return true;
	});
	jstex.newCommand("zauber",function(tokens,parent){
	    var opt = jstex.parseKeyValArg(tokens);
	    var title = parent.createChild("h3",{"width":"50%","style":{"margin-bottom":"0px"}});
	    title.innerHTML=opt.name;
	    var spelltype = parent.createChild("div");
	    spelltype.appendText(opt.art);
	    if(parseInt(opt.stufe)) spelltype.appendText(" der Stufe "+opt.stufe);
	    else spelltype.appendText(" der Großen Magie");
	    if(opt.material){
		var material = parent.createChild("span",{"style":{"font-style":"italic"}});
		material.innerHTML=opt.material;
		if(opt.matpreis){
		    var matpreis = parent.createChild("span");
		    matpreis.innerHTML=" ("+opt.matpreis+")";
		}
		if(opt.matannotation){
		    var matpreis = parent.createChild("span");
		    matannotation.innerHTML=" "+jstex.getHTMLAlias("&ndash;" )+" "+opt.matannotation;
		}
		parent.createChild("br");
	    }
	    var formula = parent.createChild("div");
	    formula.appendText(opt.prozess + " ");
	    jstex.getCommand("imgModus").expand(0,formula);
	    formula.appendText(" " + opt.agens + " ");
	    jstex.getCommand("imgObjectum").expand(0,formula);
	    formula.appendText(" "+opt.reagens);
	    var table = parent.createChild("table");
	    jstex.packages.midgard.createSpellTabRow(table,"AP-Verbrauch:",opt.AP);
	    jstex.packages.midgard.createSpellTabRow(table,"Reichweite:",opt.Rw);
	    jstex.packages.midgard.createSpellTabRow(table,"Wirkungsziel:",opt.Wz);
	    jstex.packages.midgard.createSpellTabRow(table,"Wirkungsbereich:",opt.Wb);
	    jstex.packages.midgard.createSpellTabRow(table,"Wirkungsdauer:",opt.Wd);
	    jstex.packages.midgard.createSpellTabRow(table,"Ursprung:",opt.Ur);
	    var FP = opt.FP;
	    var learning = parent.createChild("div");
	    learning.createChild("span",{"className":"midgard_lernkosten"}).innerHTML=parseInt(FP)/2+":";
	    learning.appendText(" ");
	    learning.createChild("span").innerHTML=opt.G;
	    learning.appendText(" "+jstex.getHTMLAlias("&ndash;" )+" ");
	    learning.createChild("span",{"className":"midgard_lernkosten"}).innerHTML=parseInt(FP)+":";
	    learning.appendText(" ");
	    learning.createChild("span").innerHTML=opt.S;
	    learning.appendText(" "+jstex.getHTMLAlias("&ndash;" )+" ");
	    learning.createChild("span",{"className":"midgard_lernkosten"}).innerHTML=parseInt(FP)*5+":";
	    learning.appendText(" ");
	    learning.createChild("span").innerHTML=opt.A;
	    return true;
	});
	jstex.newCommand("best",function(tokens,parent){
	    var opt = jstex.parseKeyValArg(tokens);
	    var block = parent.createChild("div");
	    block.createChild("span",{"style":{"font-weight":"bold"}}).innerHTML=opt.name;
	    block.appendText(" ");
	    block.createChild("span").innerHTML="(Grad "+opt.grad+")";
	    var block = parent.createChild("div");
	    block.createChild("span").innerHTML=(opt.LP ? opt.LP : "❋") +" LP";
	    block.appendText(", ");
	    block.createChild("span").innerHTML=(opt.AP ? opt.AP : "❋") +" AP";
	    block.appendText(" "+jstex.getHTMLAlias("&ndash;" )+" ");
	    block.createChild("span").innerHTML=(opt.RK ? opt.RK : "❋R");
	    block.appendText(" "+jstex.getHTMLAlias("&ndash;" )+" ");
	    block.createChild("span").innerHTML="St "+(opt.St ? opt.St : "❋");
	    block.appendText(", ");
	    block.createChild("span").innerHTML="Gw "+(opt.Gw ? opt.Gw : "❋");
	    block.appendText(", ");
	    block.createChild("span").innerHTML="B "+(opt.B ? opt.B : "❋");
	    var block = parent.createChild("div");
	    block.createChild("span",{"style":{"font-weight":"bold"}}).innerHTML="Angriff:";
	    block.appendText(" ");
	    block.createChild("span").innerHTML=opt.angriff;
	    block.appendText(" "+jstex.getHTMLAlias("&ndash;" )+" ");
	    block.createChild("span",{"style":{"font-variant":"small-caps"}}).innerHTML="Abwehr+"+opt.abwehr;
	    block.appendText(" "+jstex.getHTMLAlias("&ndash;" )+" ");
	    block.createChild("span",{"style":{"font-variant":"small-caps"}}).innerHTML="Resistenz+"+opt.resistenz;
	    if(opt.bes){
		var block = parent.createChild("div");
		block.createChild("span",{"style":{"font-weight":"bold"}}).innerHTML="Bes.:";
		block.appendText(" ");
		block.createChild("span").innerHTML=opt.bes;
	    }
	    return true;
	});
	jstex.newCommand("zaubervariante",function(tokens,target){return jstex.expandNext(tokens,target.createChild("span",{"style":{"font-weight":"bold"}}))});
	jstex.newEnvironment("rundbox",function(tokens,target){return jstex.expand(tokens,target.createChild("div",{"style":{"border":"2px sollid", "border-radius":"1em"}}))});
	jstex.newEnvironment("beispiel",function(tokens,target){return jstex.expand(tokens,target.createChild("div",{"style":{"border":"2px sollid", "border-radius":"1em","background-color":"lightgrey", "box-shadow": "10px 10px 5px #888888","padding":".5em"}}))});

	// add some custom classes
	var style = document.createElement('style');
	style.type = 'text/css';
	style.innerHTML+= '.midgard_zauberTabTitle { font-weight:bold; width:10em; }';
	style.innerHTML+= '.midgard_zauberTabValue { font-weight:normal; }';
	style.innerHTML+= '.midgard_lernkosten { font-weight:bold; }';
	document.getElementsByTagName('head')[0].appendChild(style);

	return true;
    },
    createSpellTabRow:function(table,title,value){
	var row = table.createChild("tr")
	row.createChild("td",{"className":"midgard_zauberTabTitle"}).innerText = title;
	row.createChild("td",{"className":"midgard_zauberTabValue"}).innerHTML = value;
    }
}












